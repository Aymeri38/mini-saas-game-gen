// app/api/generate/route.tsimport { NextResponse } from 'next/server';import OpenAI from 'openai';const openai = new OpenAI({  apiKey: process.env.OPENAI_API_KEY,});// Définition du système pour forcer le format JSONconst SYSTEM_PROMPT = `Tu es un moteur de jeu expert et un développeur senior.Ta mission : Créer ou modifier des jeux web simples (HTML/CSS/JS) en fonction des demandes de l'utilisateur.RÈGLES STRICTES :1. Tu dois retourner UNIQUEMENT un objet JSON valide.2. Pas de texte avant ou après le JSON (pas de markdown \`\`\`json).3. La structure JSON doit être :{  "html": "<contenu du body html>",  "css": "<contenu css sans balise style>",  "js": "<contenu js sans balise script>"}4. Si l'utilisateur demande une modification, base-toi sur le code précédent fourni.5. Le code doit être autonome (pas d'images externes qui nécessitent un chargement, utilise des couleurs ou des canvas).`;export async function POST(req: Request) {  try {    const { message, currentCode } = await req.json();    // On prépare le contexte pour l'IA    const messages: any[] = [      { role: "system", content: SYSTEM_PROMPT },    ];    // Si on a déjà du code, on le donne en contexte    if (currentCode.html) {        messages.push({            role: "system",             content: `Code actuel du jeu : \nHTML: ${currentCode.html}\nCSS: ${currentCode.css}\nJS: ${currentCode.js}`        });    }    // La demande de l'utilisateur    messages.push({ role: "user", content: message });    const completion = await openai.chat.completions.create({      model: "gpt-4-turbo-preview", // Ou gpt-3.5-turbo pour moins cher      messages: messages,      response_format: { type: "json_object" }, // Force le mode JSON    });    const content = completion.choices[0].message.content;        if (!content) throw new Error("Aucune réponse de l'IA");    const codeFiles = JSON.parse(content);    return NextResponse.json(codeFiles);  } catch (error) {    console.error("Erreur API:", error);    return NextResponse.json({ error: "Erreur de génération" }, { status: 500 });  }}